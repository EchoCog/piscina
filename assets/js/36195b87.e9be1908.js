"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3368],{5933:(e,r,n)=>{n.d(r,{TF:()=>s});var t=n(4848),a=n(8453);const s=()=>{const e={code:"code",pre:"pre",...(0,a.R)()};return(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",title:"workerWrapper.js",children:'const { workerData } = require(\'worker_threads\');\n\nif (workerData.fullpath.endsWith(".ts")) {\nrequire("ts-node").register();\n}\nmodule.exports = require(workerData.fullpath);\n'})})}},244:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>u,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>c,toc:()=>d});var t=n(4848),a=n(8453),s=(n(5933),n(1470)),o=n(9365);const i={id:"Move",sidebar_position:6},l=void 0,c={id:"examples/Move",title:"Move",description:"Piscina provides a move() function that allows the transfer of data between the main thread and worker threads. The example below will show you how to use Piscina.move() to transfer ArrayBuffer without cloning, which can significantly improve performance for large data transfers.",source:"@site/docs/examples/move.mdx",sourceDirName:"examples",slug:"/examples/Move",permalink:"/examples/Move",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{id:"Move",sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"Messages",permalink:"/examples/Messages"},next:{title:"Multiple Workers",permalink:"/examples/Multiple Workers"}},u={},d=[];function p(e){const r={a:"a",code:"code",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(r.p,{children:["Piscina provides a ",(0,t.jsx)(r.code,{children:"move()"})," function that allows the transfer of data between the main thread and worker threads. The example below will show you how to use ",(0,t.jsx)(r.code,{children:"Piscina.move()"})," to transfer ",(0,t.jsx)(r.code,{children:"ArrayBuffer"})," without cloning, which can significantly improve performance for large data transfers."]}),"\n",(0,t.jsxs)(s.A,{children:[(0,t.jsx)(o.A,{value:"Javascript",children:(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-javascript",metastring:'title="index.js"',children:"const Piscina = require('piscina');\nconst { resolve } = require('path');\n\nconst pool = new Piscina({\n  filename: resolve(__dirname, 'worker.js'),\n  idleTimeout: 1000\n});\n\n(async () => {\n  // The task will transfer an ArrayBuffer\n  // back to the main thread rather than\n  // cloning it.\n  const u8 = await pool.run(Piscina.move(new Uint8Array(2)));\n  console.log(u8.length);\n})();\n"})})}),(0,t.jsx)(o.A,{value:"Typescript",children:(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-typescript",metastring:'title="index.ts"',children:"import Piscina from 'piscina';\nimport { resolve } from 'path';\n\nconst pool = new Piscina({\n  filename: resolve(__dirname, 'worker.ts'),\n  idleTimeout: 1000\n});\n\n(async () => {\n  // The task will transfer an ArrayBuffer\n  // back to the main thread rather than\n  // cloning it.\n  const u8 = await pool.run(Piscina.move(new Uint8Array(2)));\n  console.log(u8.length);\n})();\n"})})})]}),"\n",(0,t.jsxs)(r.p,{children:["The worker file uses ",(0,t.jsx)(r.code,{children:"move()"})," to transfer data back to the main thread:"]}),"\n",(0,t.jsxs)(s.A,{children:[(0,t.jsx)(o.A,{value:"Javascript",children:(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-javascript",metastring:'title="worker.js"',children:"const { move } = require('piscina');\n\nmodule.exports = () => {\n  // Using move causes the Uint8Array to be\n  // transferred rather than cloned.\n  return move(new Uint8Array(10));\n};\n"})})}),(0,t.jsx)(o.A,{value:"Typescript",children:(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-typescript",metastring:'title="worker.ts"',children:'import { resolve } from "path";\nimport { move } from "piscina";\n\n\nexport const filename = resolve(__filename);\n\nexport default (): Uint8Array => {\n  // Using move causes the Uint8Array to be\n  // transferred rather than cloned.\n  return move(new Uint8Array(10)) as Uint8Array;\n};\n\n'})})})]}),"\n",(0,t.jsxs)(r.p,{children:["You can also check out this example on ",(0,t.jsx)(r.a,{href:"https://github.com/piscinajs/piscina/tree/current/examples/move",children:"github"}),"."]})]})}function h(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}},9365:(e,r,n)=>{n.d(r,{A:()=>o});n(6540);var t=n(4164);const a={tabItem:"tabItem_Ymn6"};var s=n(4848);function o(e){let{children:r,hidden:n,className:o}=e;return(0,s.jsx)("div",{role:"tabpanel",className:(0,t.A)(a.tabItem,o),hidden:n,children:r})}},1470:(e,r,n)=>{n.d(r,{A:()=>j});var t=n(6540),a=n(4164),s=n(3104),o=n(6347),i=n(205),l=n(7485),c=n(1682),u=n(679);function d(e){return t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:r}=e;return!!r&&"object"==typeof r&&"value"in r}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:r,children:n}=e;return(0,t.useMemo)((()=>{const e=r??function(e){return d(e).map((e=>{let{props:{value:r,label:n,attributes:t,default:a}}=e;return{value:r,label:n,attributes:t,default:a}}))}(n);return function(e){const r=(0,c.X)(e,((e,r)=>e.value===r.value));if(r.length>0)throw new Error(`Docusaurus error: Duplicate values "${r.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[r,n])}function h(e){let{value:r,tabValues:n}=e;return n.some((e=>e.value===r))}function m(e){let{queryString:r=!1,groupId:n}=e;const a=(0,o.W6)(),s=function(e){let{queryString:r=!1,groupId:n}=e;if("string"==typeof r)return r;if(!1===r)return null;if(!0===r&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:r,groupId:n});return[(0,l.aZ)(s),(0,t.useCallback)((e=>{if(!s)return;const r=new URLSearchParams(a.location.search);r.set(s,e),a.replace({...a.location,search:r.toString()})}),[s,a])]}function f(e){const{defaultValue:r,queryString:n=!1,groupId:a}=e,s=p(e),[o,l]=(0,t.useState)((()=>function(e){let{defaultValue:r,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(r){if(!h({value:r,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${r}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return r}const t=n.find((e=>e.default))??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:r,tabValues:s}))),[c,d]=m({queryString:n,groupId:a}),[f,v]=function(e){let{groupId:r}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(r),[a,s]=(0,u.Dv)(n);return[a,(0,t.useCallback)((e=>{n&&s.set(e)}),[n,s])]}({groupId:a}),b=(()=>{const e=c??f;return h({value:e,tabValues:s})?e:null})();(0,i.A)((()=>{b&&l(b)}),[b]);return{selectedValue:o,selectValue:(0,t.useCallback)((e=>{if(!h({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),v(e)}),[d,v,s]),tabValues:s}}var v=n(2303);const b={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var g=n(4848);function x(e){let{className:r,block:n,selectedValue:t,selectValue:o,tabValues:i}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,s.a_)(),u=e=>{const r=e.currentTarget,n=l.indexOf(r),a=i[n].value;a!==t&&(c(r),o(a))},d=e=>{let r=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const n=l.indexOf(e.currentTarget)+1;r=l[n]??l[0];break}case"ArrowLeft":{const n=l.indexOf(e.currentTarget)-1;r=l[n]??l[l.length-1];break}}r?.focus()};return(0,g.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":n},r),children:i.map((e=>{let{value:r,label:n,attributes:s}=e;return(0,g.jsx)("li",{role:"tab",tabIndex:t===r?0:-1,"aria-selected":t===r,ref:e=>l.push(e),onKeyDown:d,onClick:u,...s,className:(0,a.A)("tabs__item",b.tabItem,s?.className,{"tabs__item--active":t===r}),children:n??r},r)}))})}function w(e){let{lazy:r,children:n,selectedValue:a}=e;const s=(Array.isArray(n)?n:[n]).filter(Boolean);if(r){const e=s.find((e=>e.props.value===a));return e?(0,t.cloneElement)(e,{className:"margin-top--md"}):null}return(0,g.jsx)("div",{className:"margin-top--md",children:s.map(((e,r)=>(0,t.cloneElement)(e,{key:r,hidden:e.props.value!==a})))})}function y(e){const r=f(e);return(0,g.jsxs)("div",{className:(0,a.A)("tabs-container",b.tabList),children:[(0,g.jsx)(x,{...r,...e}),(0,g.jsx)(w,{...r,...e})]})}function j(e){const r=(0,v.A)();return(0,g.jsx)(y,{...e,children:d(e.children)},String(r))}},8453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>i});var t=n(6540);const a={},s=t.createContext(a);function o(e){const r=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),t.createElement(s.Provider,{value:r},e.children)}}}]);