"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4302],{5933:(e,n,r)=>{r.d(n,{TF:()=>s});var t=r(4848),i=r(8453);const s=()=>{const e={code:"code",pre:"pre",...(0,i.R)()};return(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",title:"workerWrapper.js",children:'const { workerData } = require(\'worker_threads\');\n\nif (workerData.fullpath.endsWith(".ts")) {\nrequire("ts-node").register();\n}\nmodule.exports = require(workerData.fullpath);\n'})})}},3738:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>p,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>c,toc:()=>l});var t=r(4848),i=r(8453),s=r(5933);const o={id:"Typescript",sidebar_position:19},a=void 0,c={id:"examples/Typescript",title:"Typescript",description:"Although Piscina itself is written in TypeScript and supports TypeScript out of the box, complication arises when trying to use .ts files directly as worker files because Node.js does not support TypeScript natively.",source:"@site/docs/examples/typescript.mdx",sourceDirName:"examples",slug:"/examples/Typescript",permalink:"/examples/Typescript",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:19,frontMatter:{id:"Typescript",sidebar_position:19},sidebar:"tutorialSidebar",previous:{title:"Task Queue",permalink:"/examples/Task Queue"},next:{title:"Web Streams",permalink:"/examples/Web Streams"}},p={},l=[{value:"Method 1: Using a Worker Wrapper File and <code>ts_node</code>",id:"method-1-using-a-worker-wrapper-file-and-ts_node",level:2},{value:"Method 2: Inline Worker Code",id:"method-2-inline-worker-code",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["Although Piscina itself is written in TypeScript and supports TypeScript out of the box, complication arises when trying to use ",(0,t.jsx)(n.code,{children:".ts"})," files directly as worker files because Node.js does not support TypeScript natively."]}),"\n",(0,t.jsxs)(n.p,{children:["To work around this, you would typically need to compile your TypeScript worker files to JavaScript first, and then point Piscina\u2019s ",(0,t.jsx)(n.code,{children:"filename"})," option to the compiled JavaScript files.  Consider the following methods:"]}),"\n",(0,t.jsxs)(n.h2,{id:"method-1-using-a-worker-wrapper-file-and-ts_node",children:["Method 1: Using a Worker Wrapper File and ",(0,t.jsx)(n.code,{children:"ts_node"})]}),"\n",(0,t.jsxs)(n.p,{children:["The worker wrapper checks if the provided file path ends with ",(0,t.jsx)(n.code,{children:".ts"})," and registers the ",(0,t.jsx)(n.code,{children:"ts-node"})," compiler to handle TypeScript files."]}),"\n",(0,t.jsx)(s.TF,{}),"\n",(0,t.jsxs)(n.p,{children:["In your ",(0,t.jsx)(n.code,{children:"worker.ts"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",metastring:"title='worker.ts'",children:"\nimport { resolve } from 'path';\n\nexport const filename = resolve(__filename);\n\ninterface Inputs {\n  a: number;\n  b: number;\n}\n\nexport function addNumbers({ a, b }: Inputs): number {\n  return a + b;\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"Inside the main application:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",metastring:"title='main.ts'",children:"\nimport Piscina from 'piscina';\nimport { resolve } from 'path';\nimport { filename } from './worker';\n\nconst piscina = new Piscina({\n  filename: resolve(__dirname, './workerWrapper.js'),\n  workerData: { fullpath: filename },\n});\n\n(async () => {\n  const result = await piscina.run({ a: 2, b: 3 }, { name: 'addNumbers' });\n  console.log('Result:', result);\n})();\n"})}),"\n",(0,t.jsx)(n.h2,{id:"method-2-inline-worker-code",children:"Method 2: Inline Worker Code"}),"\n",(0,t.jsxs)(n.p,{children:["Alternatively, you can include the worker code in the same file as your main code and use the ",(0,t.jsx)(n.code,{children:"isMainThread"})," flag from ",(0,t.jsx)(n.code,{children:"worker_threads"})," to determine whether the code is running in the main thread or the worker thread."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",metastring:'title="main.ts"',children:"\nimport Piscina from 'piscina';\nimport { isMainThread } from 'worker_threads';\n\ninterface Inputs {\n  a: number;\n  b: number;\n}\n\nif (isMainThread) {\n  const piscina = new Piscina({ filename: __filename });\n\n  (async () => {\n    const task: Inputs = { a: 1, b: 2 };\n    console.log(await piscina.run(task));\n  })();\n} else {\n  export default ({ a, b }: Inputs): number => {\n    return a + b;\n  };\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["You can also check out this example on ",(0,t.jsx)(n.a,{href:"https://github.com/piscinajs/piscina/tree/current/examples/typescript",children:"github"}),"."]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>a});var t=r(6540);const i={},s=t.createContext(i);function o(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);